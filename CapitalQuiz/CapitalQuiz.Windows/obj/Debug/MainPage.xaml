<Page
    x:Class="CapitalQuiz.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CapitalQuiz"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:Interactivity="using:Microsoft.Xaml.Interactivity" xmlns:Core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:Controls="using:CapitalQuiz.Controls"
    mc:Ignorable="d"
    DataContext="{Binding Game, Source={StaticResource Locator}}">
    
    <Interactivity:Interaction.Behaviors>
        <Core:EventTriggerBehavior EventName="Loaded">
            <Core:InvokeCommandAction Command="{Binding Init}" />
        </Core:EventTriggerBehavior>
    </Interactivity:Interaction.Behaviors>
    
    <Grid Style="{StaticResource BackgroundGrid}">
        <TextBlock Text="{Binding Time}"
                   Visibility="{Binding IsCountbackVisible, Converter={StaticResource BooleanVisibilityConverter}}"
                   Style="{StaticResource CountbackTimerTextBlock}"/>
        
        <Popup IsOpen="{Binding IsAlive, Converter={StaticResource BooleanNegationConverter}}">
            <Controls:GameOverControl />
        </Popup>
        
        <Grid Visibility="{Binding IsCountbackVisible, Converter={StaticResource BooleanVisibilityNegationConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            
            <TextBlock Grid.Row="0"
                       Text="{Binding Question.Text}" />
            
            <ListView Grid.Row="1"
                      ItemsSource="{Binding Question.AllAnswers}"
                      Style="{StaticResource CenterListView}">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Button x:Name="AnswerButton"
                                Content="{Binding Text}"
                                Command="{Binding Game.SetAnswer, Source={StaticResource Locator}}" CommandParameter="{Binding Text}"
                                IsEnabled="{Binding Game.IsAlive, Source={StaticResource Locator}}">
                            <Interactivity:Interaction.Behaviors>
                                <Core:DataTriggerBehavior Binding="{Binding IsGoodAnswer}"
                                                          ComparisonCondition="Equal"
                                                          Value="true">
                                    <Core:ChangePropertyAction PropertyName="Background"
                                                               TargetObject="{Binding ElementName=AnswerButton}"
                                                               Value="Red" />
                                </Core:DataTriggerBehavior>
                            </Interactivity:Interaction.Behaviors>
                        </Button>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapGrid Style="{StaticResource TwoRowWrapGrid}" />
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
            </ListView>
            
            <ProgressBar Grid.Row="2"
                         Maximum="30"
                         Value="{Binding Time}" />
        </Grid>
    </Grid>
</Page>

